<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.store.meonggae.event">
<!-- 이벤트 총 개수 -->
<select id="selectTotalCount" resultType="int" parameterType="pagingVO">
select count(*) from VIEW_EVENT
<where>
<if test="keyword != null and keyword != ''">
	REPLACE(
	<choose>
		<when test ="field == 0">
			title
		</when>
		<when test="field == 1">
			content
		</when>
		<otherwise>
			event_status
		</otherwise>
	</choose>
	, ' ', '') like '%'||REPLACE(#{keyword}, ' ', '')||'%'
</if>
</where>
</select>
<!-- 이벤트 목록 -->
<select id="selectEventList" resultType="com.store.meonggae.event.domain.EventDomain" parameterType="pagingVO">
select rnum, EVENT_NUM as eventNum, title, img, start_date, end_date, input_date, cnt, event_status
from (
select EVENT_NUM, title, img, start_date, end_date, input_date, cnt, event_status,
row_number() over(order by start_date desc, end_date asc) rnum
from VIEW_EVENT
<where>
	<if test="keyword != null and keyword != ''">
		REPLACE(
		<choose>
			<when test="field == 0">
			title
			</when>
			<when test="field == 1">
			content
			</when>
			<otherwise>
			event_status
			</otherwise>
		</choose>
		, ' ', '') like '%'||REPLACE(#{ keyword }, ' ', '')||'%'
	</if>
	<if test="eventStatus != null and eventStatus != ''">
		<choose>
			<when test="eventStatus == 1">
		 		and end_date > SYSDATE
			</when>
			<when test="eventStatus == 2">
				and <![CDATA[end_date < SYSDATE]]>
			</when>
		</choose>
	</if>
</where>
) where rnum between #{ startPageNum } and #{ endPageNum }
</select>
<!-- 이벤트 상세페이지 -->
<select id="selectDetailEvent" resultType="com.store.meonggae.event.domain.EventDomain" parameterType="int">
	select title, content, img, start_date, end_date, cnt
	from event
	where event_num=#{ event_num, jdbcType=VARCHAR }
</select>
<!-- 조회수 cnt -->
<update id="updateCnt" parameterType="int">
	update event
	set cnt=cnt+1
	where event_num=#{event_num, jdbcType=VARCHAR}
</update>
</mapper>